<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ùüûùüü</title>
<style>
  :root{
    --bg:#07060a;
    --panel:#0e0d12;
    --glow:#0ef07a;
    --muted:#8a8a8f;
    --accent:#00ff99;
    --danger:#ff3b3b;
    --mono: "Courier New", Courier, monospace;
  }
  html,body{height:100%;margin:0;font-family:var(--mono);background:radial-gradient(ellipse at center, #0a0a0b 0%, var(--bg) 60%);color:#cfeee0;}
  .wrap{
    max-width:1100px;margin:28px auto;padding:24px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border-radius:12px;box-shadow:0 0 40px rgba(0,255,140,0.03);
    border:1px solid rgba(255,255,255,0.02);
    position:relative;overflow:hidden;
  }
  header{display:flex;align-items:center;gap:16px;margin-bottom:12px}
  .skull{
    width:56px;height:56px;border-radius:8px;background:linear-gradient(180deg,#111,#000);display:flex;align-items:center;justify-content:center;color:var(--glow);font-size:28px;box-shadow:0 0 12px rgba(0,255,120,0.08);
    border:1px solid rgba(0,255,120,0.08);
  }
  h1{margin:0;font-size:20px;color:var(--accent)}
  p.lead{margin:0;color:var(--muted);font-size:13px}
  .controls{position:absolute;right:20px;top:20px;display:flex;gap:8px}
  button.btn{
    background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:8px;color:var(--accent);cursor:pointer;font-family:var(--mono);
  }
  button.ghost{color:var(--muted);border-color:rgba(255,255,255,0.02)}
  .grid{display:grid;grid-template-columns:1fr 420px;gap:20px;margin-top:18px}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.02));padding:16px;border-radius:10px;border:1px solid rgba(255,255,255,0.02);min-height:240px;overflow:auto}
  .big-ip{font-size:36px;color:var(--glow);letter-spacing:2px}
  .muted{color:var(--muted);font-size:12px}
  dl{display:grid;grid-template-columns:160px 1fr;gap:6px 14px;margin:12px 0 0 0}
  dt{color:var(--muted);font-size:12px}
  dd{margin:0;font-size:14px;color:#e6fff0}
  .map{height:220px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:linear-gradient(180deg,#081012,#041) center/cover no-repeat}
  pre.json{background:#040404;color:#c9ffd8;padding:12px;border-radius:8px;overflow:auto;border:1px solid rgba(0,255,150,0.06);max-height:300px}
  .row{display:flex;gap:8px;align-items:center}
  .pill{padding:6px 8px;border-radius:999px;background:rgba(0,0,0,0.25);border:1px solid rgba(255,255,255,0.02);font-size:12px}
  .warning{color:var(--danger);font-weight:600}
  .footer{margin-top:14px;color:var(--muted);font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="skull">üíÄ</div>
    <div>
      <h1>IP Sleuth</h1>
      <p class="lead">Creepy, dark, and thorough ‚Äî shows IP, geo, timezone, ISP, flags, browser info, and more.</p>
    </div>
    <div class="controls">
      <button id="refresh" class="btn">Refresh</button>
      <button id="download" class="btn ghost">Download JSON</button>
      <button id="copyBtn" class="btn ghost">Copy JSON</button>
    </div>
  </header>

  <div class="grid">
    <div class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div>
          <div class="big-ip" id="ipDisplay">‚Äî.‚Äî.‚Äî.‚Äî</div>
          <div class="muted" id="ipInfoLine">Detecting IP and associated info‚Ä¶</div>
        </div>
        <div style="text-align:right">
          <div class="pill" id="flagPill">üè≥Ô∏è</div>
          <div class="muted" style="margin-top:8px;font-size:12px" id="orgPill">org: ‚Äî</div>
        </div>
      </div>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.02);margin:12px 0">

      <h3 style="margin:6px 0;color:var(--accent)">Location & Time</h3>
      <dl id="locationList">
        <dt>IP</dt><dd id="ip">‚Äî</dd>
        <dt>Hostname</dt><dd id="hostname">‚Äî</dd>
        <dt>ISP / Org</dt><dd id="org">‚Äî</dd>
        <dt>ASN</dt><dd id="asn">‚Äî</dd>
        <dt>Country / Region</dt><dd id="country">‚Äî</dd>
        <dt>City / Postal</dt><dd id="city">‚Äî</dd>
        <dt>Lat / Lon</dt><dd id="latlon">‚Äî</dd>
        <dt>Timezone</dt><dd id="timezone">‚Äî</dd>
        <dt>Local Time</dt><dd id="localtime">‚Äî</dd>
        <dt>Currency</dt><dd id="currency">‚Äî</dd>
        <dt>Languages</dt><dd id="languages">‚Äî</dd>
        <dt>Proxy / VPN</dt><dd id="proxy">‚Äî</dd>
      </dl>

      <hr style="border:none;border-top:1px solid rgba(255,255,255,0.02);margin:12px 0">

      <h3 style="margin:6px 0;color:var(--accent)">Browser / Device</h3>
      <dl>
        <dt>User Agent</dt><dd id="ua">‚Äî</dd>
        <dt>Browser Locale</dt><dd id="locale">‚Äî</dd>
        <dt>Navigator Platform</dt><dd id="platform">‚Äî</dd>
        <dt>Connection</dt><dd id="connection">‚Äî</dd>
        <dt>Screen</dt><dd id="screen">‚Äî</dd>
        <dt>Geolocation</dt><dd id="geolocStatus">Not requested</dd>
      </dl>
      <div class="footer">Some fields require user permission or a paid API. Use responsibly. Do not use to stalk or harass.</div>
    </div>

    <div class="panel">
      <div style="display:flex;gap:12px;align-items:center;margin-bottom:10px">
        <button id="locBtn" class="btn">Request Precise Geolocation</button>
        <div class="pill" id="geoPerm">geo: unknown</div>
      </div>

      <div class="map" id="map">
        <div style="padding:14px;color:var(--muted)">Map preview will appear when geolocation / lat/lon available.</div>
      </div>

      <h3 style="margin-top:12px;color:var(--accent)">Raw JSON</h3>
      <pre class="json" id="rawJson">{}</pre>
    </div>
  </div>
</div>

<script>
/*
  IP Sleuth (client-only)
  - Uses ipify to get public IP
  - Then queries ipapi.co (free tier) to get geo / org / timezone info
  - Also collects browser info and optional geolocation (if allowed)
  - You can swap APIs: ipinfo, ipgeolocation, ipapi, ipdata, etc.
*/

// Config: endpoints
const IPIFY = 'https://api.ipify.org?format=json';
const GEO_API_BASE = 'https://ipapi.co'; // ipapi.co JSON endpoints (no key for basic use)

// Utility: safe fetch w/ timeout
async function fetchWithTimeout(url, options={}, timeout=8000){
  const controller = new AbortController();
  const id = setTimeout(()=>controller.abort(), timeout);
  try{
    const res = await fetch(url, {...options, signal: controller.signal});
    clearTimeout(id);
    if(!res.ok) throw new Error('HTTP ' + res.status);
    return res.json();
  } catch(e){
    clearTimeout(id);
    throw e;
  }
}

const elements = {
  ipDisplay: document.getElementById('ipDisplay'),
  ipInfoLine: document.getElementById('ipInfoLine'),
  ip: document.getElementById('ip'),
  hostname: document.getElementById('hostname'),
  org: document.getElementById('org'),
  asn: document.getElementById('asn'),
  country: document.getElementById('country'),
  city: document.getElementById('city'),
  latlon: document.getElementById('latlon'),
  timezone: document.getElementById('timezone'),
  localtime: document.getElementById('localtime'),
  currency: document.getElementById('currency'),
  languages: document.getElementById('languages'),
  proxy: document.getElementById('proxy'),
  ua: document.getElementById('ua'),
  locale: document.getElementById('locale'),
  platform: document.getElementById('platform'),
  connection: document.getElementById('connection'),
  screen: document.getElementById('screen'),
  geolocStatus: document.getElementById('geolocStatus'),
  rawJson: document.getElementById('rawJson'),
  map: document.getElementById('map'),
  flagPill: document.getElementById('flagPill'),
  orgPill: document.getElementById('orgPill'),
  geoPerm: document.getElementById('geoPerm')
};

let lastData = {}; // aggregated

async function main(){
  setStatus('Detecting public IP‚Ä¶');
  try{
    const ipResp = await fetchWithTimeout(IPIFY, {}, 7000);
    const ip = ipResp?.ip || 'unknown';
    elements.ipDisplay.textContent = ip;
    elements.ip.textContent = ip;
    setStatus('Querying geo info for ' + ip + ' ...');

    // Query ipapi.co
    // ipapi.co supports: /json/{ip}/ and /json/
    // We'll attempt /json/{ip}/full to get more fields (but not all fields are guaranteed).
    let geoData;
    try{
      geoData = await fetchWithTimeout(`${GEO_API_BASE}/${ip}/json/`, {}, 9000);
    } catch(e){
      // fallback: try general json
      try { geoData = await fetchWithTimeout(`${GEO_API_BASE}/json/`, {}, 9000); }
      catch(e2){ geoData = null; }
    }

    // Browser info
    const navigatorInfo = {
      userAgent: navigator.userAgent,
      language: navigator.language || navigator.languages?.[0],
      languages: navigator.languages,
      platform: navigator.platform,
      vendor: navigator.vendor,
      online: navigator.onLine,
      cookieEnabled: navigator.cookieEnabled,
      hardwareConcurrency: navigator.hardwareConcurrency,
      deviceMemory: navigator.deviceMemory || 'unknown'
    };

    // Connection info (may be undefined)
    const conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
    const connectionInfo = conn ? {
      effectiveType: conn.effectiveType,
      downlink: conn.downlink,
      rtt: conn.rtt,
      saveData: conn.saveData
    } : null;

    // Timezone: from browser
    const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || (geoData && geoData.timezone) || 'unknown';
    const localTime = (new Date()).toLocaleString('en-US', {timeZone: tz});

    // Geolocation: left for user action ‚Äî but we will show last known lat/lon from geoData
    // Aggregate
    lastData = {
      fetched_at: (new Date()).toISOString(),
      ipify: ipResp,
      geo_api: geoData,
      browser: navigatorInfo,
      connection: connectionInfo,
      timezone: tz,
      local_time: localTime,
      screen: {
        width: screen.width,
        height: screen.height,
        availWidth: screen.availWidth,
        availHeight: screen.availHeight,
        pixelDepth: screen.pixelDepth
      }
    };

    renderFromData(lastData);
    setStatus('Done ‚Äî data below.');
  } catch(err){
    console.error(err);
    setStatus('Error: ' + (err.message || String(err)));
  }
}

function setStatus(txt){
  elements.ipInfoLine.textContent = txt;
}

// Render aggregated results into UI
function renderFromData(data){
  const geo = data.geo_api || {};
  elements.ip.textContent = data.ipify?.ip || '‚Äî';
  elements.hostname.textContent = geo?.hostname || geo?.org || '‚Äî';
  elements.org.textContent = geo?.org || geo?.asn || '‚Äî';
  elements.asn.textContent = geo?.asn || geo?.org || '‚Äî';
  elements.country.textContent = [geo?.country_name, geo?.region].filter(Boolean).join(' ‚Äî ') || '‚Äî';
  elements.city.textContent = [geo?.city, geo?.postal].filter(Boolean).join(' / ') || '‚Äî';
  elements.latlon.textContent = (geo?.latitude && geo?.longitude) ? `${geo.latitude}, ${geo.longitude}` : (geo?.latitude ? `${geo.latitude}` : '‚Äî');
  elements.timezone.textContent = geo?.timezone || data.timezone || '‚Äî';
  elements.localtime.textContent = data.local_time || '‚Äî';
  elements.currency.textContent = geo?.currency || geo?.currency_code || '‚Äî';
  elements.languages.textContent = geo?.languages || (data.browser?.language ? data.browser.language : '‚Äî');
  elements.proxy.textContent = (geo?.proxy ? 'Likely Proxy/VPN' : (geo?.threat?.is_tor || geo?.threat?.is_proxy ? 'Yes' : 'Unknown'));
  elements.ua.textContent = data.browser?.userAgent || '‚Äî';
  elements.locale.textContent = data.browser?.language || '‚Äî';
  elements.platform.textContent = data.browser?.platform || '‚Äî';
  elements.connection.textContent = data.connection ? `${data.connection.effectiveType || ''} ‚Ä¢ ${data.connection.downlink || ''}Mbps` : '‚Äî';
  elements.screen.textContent = `${data.screen.width}√ó${data.screen.height}`;
  elements.geolocStatus.textContent = 'precise: not requested';
  elements.rawJson.textContent = JSON.stringify(data, null, 2);
  // Flag and org
  if (geo?.country_code){
    const cc = geo.country_code.toLowerCase();
    elements.flagPill.textContent = `${countryFlagEmoji(geo.country_code)} ${geo.country_name || geo.country_code}`;
  } else {
    elements.flagPill.textContent = 'üè≥Ô∏è';
  }
  elements.orgPill.textContent = 'org: ' + (geo?.org || geo?.asn || '‚Äî');
  // Map: if lat/lon available show simple static map from OpenStreetMap via iframe
  if (geo?.latitude && geo?.longitude){
    const lat = geo.latitude, lon = geo.longitude;
    const iframe = document.createElement('iframe');
    iframe.style.width = '100%';
    iframe.style.height = '220px';
    iframe.style.border = '0';
    iframe.loading = 'lazy';
    // Use OpenStreetMap static viewer
    const zoom = 10;
    iframe.src = `https://www.openstreetmap.org/export/embed.html?bbox=${lon-0.05}%2C${lat-0.05}%2C${lon+0.05}%2C${lat+0.05}&layer=mapnik&marker=${lat}%2C${lon}`;
    elements.map.innerHTML = '';
    elements.map.appendChild(iframe);
  } else {
    elements.map.innerHTML = '<div style="padding:14px;color:var(--muted)">Map preview will appear when lat/lon present.</div>';
  }
}

// Small helper to convert country code to emoji flag
function countryFlagEmoji(countryCode){
  if(!countryCode) return '';
  const codePoints = [...countryCode.toUpperCase()].map(c =>  127397 + c.charCodeAt());
  return String.fromCodePoint(...codePoints);
}

// Copy / Download handlers
document.getElementById('copyBtn').addEventListener('click', async () => {
  try{
    await navigator.clipboard.writeText(JSON.stringify(lastData, null, 2));
    alert('JSON copied to clipboard');
  }catch(e){
    alert('Copy failed: ' + e.message);
  }
});
document.getElementById('download').addEventListener('click', () => {
  const blob = new Blob([JSON.stringify(lastData, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `ip-sleuth-${(lastData.ipify?.ip||'unknown')}.json`;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
});

// Refresh / Request geolocation
document.getElementById('refresh').addEventListener('click', main);
document.getElementById('locBtn').addEventListener('click', () => {
  elements.geolocStatus.textContent = 'requesting permission...';
  elements.geoPerm.textContent = 'geo: asked';
  if (!navigator.geolocation){
    elements.geolocStatus.textContent = 'Geolocation API not supported';
    return;
  }
  navigator.geolocation.getCurrentPosition(pos => {
    const {latitude, longitude, accuracy, altitude, heading, speed} = pos.coords;
    elements.geolocStatus.textContent = `allowed ‚Ä¢ ${latitude.toFixed(6)}, ${longitude.toFixed(6)} (acc ${accuracy}m)`;
    elements.geoPerm.textContent = 'geo: allowed';
    // update lastData and UI
    lastData.geolocation = {latitude, longitude, accuracy, altitude, heading, speed, timestamp: pos.timestamp};
    elements.latlon.textContent = `${latitude.toFixed(6)}, ${longitude.toFixed(6)} (precise)`;
    // Show map centered to this point
    const iframe = document.createElement('iframe');
    iframe.style.width = '100%';
    iframe.style.height = '220px';
    iframe.style.border = '0';
    iframe.loading = 'lazy';
    const lat = latitude, lon = longitude;
    iframe.src = `https://www.openstreetmap.org/export/embed.html?bbox=${lon-0.01}%2C${lat-0.01}%2C${lon+0.01}%2C${lat+0.01}&layer=mapnik&marker=${lat}%2C${lon}`;
    elements.map.innerHTML = '';
    elements.map.appendChild(iframe);
    elements.rawJson.textContent = JSON.stringify(lastData, null, 2);
  }, err => {
    elements.geolocStatus.textContent = 'permission denied or error: ' + (err.message || err.code);
    elements.geoPerm.textContent = 'geo: denied';
  }, {enableHighAccuracy:true, timeout:10000, maximumAge:0});
});

// initial load
main();
</script>
</body>
</html>
